{{extend 'layoutSIRADEXloged.html'}}

{{block titulo}}
	Agregar Producto
{{end}}
{{block subtitulo}}
	{{="Actividad: "+nombre_actividad}}
{{end}}

{{block descripcion}}
<div class="col-lg-12">
	<p>{{="Descripcion: "+descripcion_actividad}}</p>
	<h4> Formulario </h4>
    <p class="text-justify">
		Los campos con asteriscos <span style="color:red">*</span> son obligatorios
    </p>
</div>
{{end}}

{{block contenido}}
	
<div class="row">
	<div class="col-md-12">
		<div class="card">
			<div class="tab-pane">
            	{{=form}}           

			</div>
		</div>
	</div>
</div>

{{end}}


{{block script}}

<script>

function textoRestante1(maxLong, idDivUsar){
  var longitudTexto = $(idDivUsar).val().length;
  var textoRestante = maxLong - longitudTexto;

  // Selecciono el div que es "hermano" del textfield de nombre.
  var longitudTextoAct = $(idDivUsar).val().length;
  $(idDivUsar).siblings(".help-block").html((maxLong - longitudTextoAct) + " caracteres");

  // Si estoy escribiendo en el textfield de nombre, entonces...
  $(idDivUsar).on('keypress keyup keydown', function(e){
    var longitudTexto = $(idDivUsar).val().length;
    var textoRestante = maxLong - longitudTexto;

    $(idDivUsar).siblings(".help-block").html(textoRestante + " caracteres.");

    /* keyCode.46: delete, keyCode.8: enter, keyCode.37 al keyCode.40: arrows. */
    if (textoRestante <= 0 && e.keyCode != 46 && e.keyCode != 8 && e.keyCode != 37
        && e.keyCode != 38 && e.keyCode != 39 && e.keyCode != 40){
          $(idDivUsar).val($(idDivUsar).val().substring(0, maxLong));
          return false;
    }
  });
};

$(document).ready(function () {
	var maxLongNombre  = 256;    // Longitud máxima que tendrá el campo nombre.
	var maxLongDescrip = 2048;   // Longitud máxima que tendrá el campo descripción.
	var comprobante_mostrado = 0;
	var error_comprobante = 0;
	var error_descripcion = 0;
	var cantidad_comprobantes = 5;
	// Muestra la cantidad de caracteres disponible en el textfield de nombre.
	textoRestante1(maxLongNombre, $("#no_table_nombre" ));

	textoRestante1(maxLongDescrip, $("#no_table_descripcion"));

	textoRestante1(maxLongNombre, $("#no_table_lugar"));

	$('#no_table_c0mpr0bant3_1__row').before('	<div id="comprobantes__row" class="form-group">\
													<hr class="col-sm-offset-3 col-sm-8">\
													<h3 class="col-sm-offset-3 col-sm-3">Comprobantes</h3>\
													<a id="agregar_comprobante" href="#" onclick="return false;">\
														<img alt="Agregar Comprobante" src="/SiraDex/static/icon/i_add.png" height="55" >\
													</a>\
												</div>'
										);
	for (i = 1; i <= cantidad_comprobantes; i++) {
    	$('#no_table_c0mpr0bant3_'+i+'__row').addClass("hidden");
    	$('#no_table_d3scr1pc10n_comprobante_'+i+'__row').addClass("hidden");
	}

	$('#agregar_comprobante').click(function(){
		if (comprobante_mostrado<cantidad_comprobantes){
			if($('#no_table_c0mpr0bant3_'+comprobante_mostrado).val()=="" ){
				if (!error_comprobante){
					$('#no_table_c0mpr0bant3_'+comprobante_mostrado).parent().append('<span id="error_archivo_'+comprobante_mostrado+'" class="help-block error">Primero debes cargar el comprobante</span>');
					error_comprobante = 1;
				}
			}
			else{
				$('#error_archivo_'+comprobante_mostrado).addClass("hidden");
				if($('#no_table_d3scr1pc10n_comprobante_'+comprobante_mostrado).val()==""){
					if (!error_descripcion){
						$('#no_table_d3scr1pc10n_comprobante_'+comprobante_mostrado).parent().append('<span id="error_descripcion_'+comprobante_mostrado+'" class="help-block error">La descripcion de un archivo cargado es obligatoria</span>');
						error_descripcion = 1;
					}
				}
				else{
					error_comprobante = 0;
					error_descripcion = 0;
					$('#error_descripcion_'+comprobante_mostrado).addClass("hidden");

					comprobante_mostrado += 1;
					$('#no_table_c0mpr0bant3_'+comprobante_mostrado+'__row').removeClass("hidden");
					$('#no_table_d3scr1pc10n_comprobante_'+comprobante_mostrado+'__row').removeClass("hidden");
					$('#no_table_c0mpr0bant3_'+comprobante_mostrado+'__row').prepend('<hr class="col-sm-offset-3 col-sm-8">');
				};
			};
		};
		if (comprobante_mostrado==cantidad_comprobantes){
			$('#agregar_comprobante').addClass("hidden");
		}

	});

  });
</script>

{{end}}


<!--<form enctype="multipart/form-data" method="post" class="form-horizontal" role="form">


					<div class="form-group">
	                    <label for="PRODUCTO_nombre" class = "control-label col-sm-3">
	                    	Nombre (*)
	                    </label>
	                    <div class="col-sm-8">
							<input id="PRODUCTO_nombre" class="form-control string" name="nombre" value="" type="text">
							<span class="help-block">
								El nombre es tentativo y luego sera actualizado por la Dex
							</span>
						</div>
	                </div>


					<div class="form-group">
	                    <label for="PRODUCTO_descripcion" class = "control-label col-sm-3">
	                    	Descripcion
	                    </label>
	                    <div class="col-sm-8">
							<input id="PRODUCTO_descripcion" class="form-control string" name="descripcion" value="" type="text">
							<span class="help-block">
								La descripcion tiene como fin familiarizar al personal de la Dex con su producto
							</span>
						</div>
	                </div>

	                <div class="form-group">
	                    <label for="Programa" class = "control-label col-sm-3"> Programa(*)</label>
	                    <div class="col-sm-8">
		                    <select class= "form-control" name="Programa" onchange="ajax('obtener_actividades', ['Programa'], ':eval')">
		                        <option selected=""></option>
		                        {{for x in programas:}}
		                        <option value="{{=x['nombre']}}">{{=x['nombre']}}</option>

		                        {{pass}}
		                    </select>
	                    </div>
	                </div>


	                <div class="form-group">
	                    <label for="id_tipo" class = "control-label col-sm-3">
	                    	Tipo Actividad (*)
	                    </label>
	                    <div class="col-sm-8 ">
		                    <select class="form-control" name="id_tipo" id="lista_tipos"  onchange="ajax('seleccion_actividad', ['id_tipo'], ':eval')">
      
		                    </select>

		                </div>
	                </div>


	                <div class="form-group">
	                    <label for="fecha" class = "control-label col-sm-3">Fecha (*)</label>
	                    <div class="col-sm-3">
	                    	<input class="form-control" type="date" name="fecha" max='{{=fecha_max}}'/>
	                    </div>
	                    <div class="col-sm-6">
	    	                <label for="lugar" class="control-label col-sm-3">Lugar (*)</label>
	    	                <div class="col-sm-7">
	                    		<input class="form-control" name="lugar"/>
	                    	</div>
	                    </div>
	                    <div class="hidden">
	                    	<input class="form-control" name="estado" value="En espera" />
	                    </div>
	                    <div class="hidden">
	                    	<input class="form-control" name="ci_usu_creador" value="{{=session.usuario['cedula']}}"/>
	                    </div>
	                </div>

	                <div  class="form-group">
	                	<h3 id="nombre_actividad" class="col-sm-offset-3"></h3>
	                	<p id="descripcion_actividad" class="col-sm-offset-3"></p>
	                	<p id="comprobantes_actividad" class="col-sm-offset-3"></p>

		                <div id="campos_actividad">
	
		                </div>
	                </div>

	               
	                
	                <div class="form-group ">
	                	<input type="submit" class="col-sm-offset-3 col-sm-8 btn blue-add btn-border " value="Agregar" />
  						<input type="hidden" name="_formname" value="crear_tipo" />
  						<input type="hidden" name="_formname_campos" value="agregar_campos" />
	                </div>
	            </form>          -->