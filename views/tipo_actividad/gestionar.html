{{extend 'layoutSIRADEXloged.html'}}

{{block titulo}}

        {{if programa_nombre != None:}}
           Programa: {{=programa_nombre}}

       {{else:}}
           Tipos de Actividades del Sistema
       {{pass}}

{{end}}

{{block descripcion}}
    <div class="col-sm-8">

        <h4><p> {{if programa_descripcion != None:}}
                       Descripción: {{=programa_descripcion}}

                {{else:}}

                {{pass}}
             </p></h4>
        <br>
    </div>
{{end}}

{{block contenido}}

    <script src="{{=URL('static','js/global.js')}}"></script>
    <script src="{{=URL('static','js/tipo_actividad.js')}}"></script>

      <div class="row">
        <div class="col-sm-6">
             <form class="navbar-form" role="search">
                <div class="input-group col-lg-12">
                    <!-- barra de busqueda -->
                        <input  type="text"
                                class="form-control"
                                placeholder="Buscar Tipo de Actividad"
                                id="form-busqueda">

                    <!-- Lupa -->
                    <span class="input-group-btn">
                        <button type="submit"
                                class="btn btn-default glyphicon glyphicon-search"
                                id="btn-lupa" style="top:0px !important;">
                        </button>
                    </span>
                 </div>
            </form>
        </div>
        <div class="col-sm-5 col-sm-push-1" style="margin-top:10px;margin-left:50px">
            <button type="button"
                    class="btn btn-default green btn-border"
                    data-toggle="modal"
                    data-target="#myModal"
                    >
              <span class="glyphicon glyphicon-plus-sign"
                    aria-hidden="true"></span> Agregar Actividad
            </button>


            <a href="{{=URL(c='archivo_historico', f='gestionar.html')}}" >
            <button type="button" class="btn btn-default red-trash btn-border">
              <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Archivo Histórico
            </button>
            </a>
        </div>
    </div>

<div>
    <br/>
    <!-- Tabla con los tipos de actividad disponibles en el sistema -->
    <div class="container-fluid card">
        <table class="table table-striped table-condensed table-hover sortable">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th><center>Editar</center></th>
                    <th><center>Inhabilitar</center></th>
                </tr>
            </thead>
            <tbody>
                {{if len(listaTipoActividades) == 0:}}
                <tr>
                    <td colspan="4"> No hay Tipos de Actividades que mostrar.</td>
                </tr>
                {{else:}}
                    {{for tipoActividad in listaTipoActividades: }}
                    <tr>
                        <td class="col-md-4">
                            <a href="{{=URL(c='tipo_actividad', f='ver_tipo_actividad',args=[tipoActividad.id_tipo])}}">
                                {{=tipoActividad.nombre}}
                            </a>
                        </td>
                        <td class="col-md-6"> {{=tipoActividad.descripcion}}</td>
                        <td class="center-vertically">
                            <center>
                                <a href="#">
                                    <span class="glyphicon glyphicon-edit blue"
                                          data-toggle="modal"
                                          data-target="#myModalEditar"
                                          data-idtipo="{{=tipoActividad.id_tipo}}"
                                          data-nombre="{{=tipoActividad.nombre}}"
                                          data-descripcion="{{=tipoActividad.descripcion}}"
                                          data-idprograma="{{=tipoActividad.id_programa}}"
                                          data-tipopr="{{=tipoActividad.tipo_p_r}}">
                                    </span>
                                </a>
                            <center>
                        </td>
                        <td class="center-vertically">
                            <center>
                                <a href="#">
                                   <span class="glyphicon glyphicon-remove red"
                                         data-toggle="modal"
                                         data-target="#myModalDelete"
                                         data-id-tipo="{{=tipoActividad.id_tipo}}">
                                   </span>
                                </a>
                            <center>
                        </td>
                    </tr>
                    {{pass}}
                {{pass}}
            </tbody>
        </table>
    </div>

<!-- Modal Agregar-->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <center><h4 class="modal-title">Agregar Tipo de Actividad</h4><center>
      </div>
      <div class="modal-body" id="agregar_tipo_actividad">
          {{=formulario_agregar_tipo}}
      </div>
    </div>
  </div>
</div>

<!-- Modal Editar-->
<div id="myModalEditar" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <center><h4 class="modal-title">Editar Tipo de Actividad</h4><center>
      </div>
      <div class="modal-body">
          <p><center id="editar_tipo_actividad"> Formulario para editar Tipo de Actividad

          </center> </p>
          {{=formulario_editar_tipo}}
      </div>
    </div>
  </div>
</div>

<!-- Modal Eliminar-->
<div class="container">
  <div class="modal fade" id="myModalDelete" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
            <center> <h4 class="modal-title">Inhabilitar Tipo de Actividad</h4> </center>
        </div>
        <div class="modal-body">
            <center> <p>¿Está seguro que quiere inhabilitar este tipo de actividad?</p> </center>
            <br>
            <center>
                <a href="javascript:location.reload();">
                  <button type="button"
                          class="btn blue-add btn-border"
                          data-dismiss="modal"
                          id="botonDelete">
                      Inhabilitar</button>
                </a>
                <button type="button" class="btn btn-default btn-border" data-dismiss="modal">Cerrar</button>
            </center>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">

    // Eliminar definitivamente

    $('#myModalDelete').on('show.bs.modal', function (event) {
        if (event.relatedTarget != null){
            $("#botonDelete").attr("data-id-tipo", event.relatedTarget.getAttribute("data-id-tipo"));
        }
    });

    $("#botonDelete").click(function (event){

        var id_tipo = $("#botonDelete").attr("data-id-tipo");
        ajax("{{=URL('enviar_tipo_papelera')}}/"+id_tipo,[]);
        location.reload();
    });




    $(document).ready(function () {
  var maxLongNombre  = 256;    // Longitud máxima que tendrá el campo nombre.
  var maxLongDescrip = 2048;   // Longitud máxima que tendrá el campo descripción.
  $('#myModalEditar').on('show.bs.modal', function(e){
      var id_tipo = $(e.relatedTarget).data('idtipo');
      var nombre      = $(e.relatedTarget).data('nombre');
      var descripcion = $(e.relatedTarget).data('descripcion');
      var id_programa = $(e.relatedTarget).data('idprograma');
      var tipoPR =  $(e.relatedTarget).data('tipopr');
      $(e.currentTarget).find('input[name="Id_tipo"]').val(id_tipo);
      $("#no_table_Id_tipo__row").css("display","none");
      $(e.currentTarget).find('input[name="Nombre"]').val(nombre);
      $(e.currentTarget).find('textarea[name="Descripcion"]').val(descripcion);
      $(e.currentTarget).find('#no_table_Programa').val(id_programa);
      $(e.currentTarget).find('#no_table_Tipo').val(tipoPR);
      // Muestra la cantidad de caracteres disponible en el textfield de nombre.
      textoRestante(maxLongNombre,  $(e.currentTarget).find("#no_table_Nombre"));

      // Muestra la cantidad de caracteres disponible en el textarea de descripción.
      textoRestante(maxLongDescrip, $(e.currentTarget).find("#no_table_Descripcion"));
  });

    });

</script>


{{end}}
